const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{display:String,name:String,block:Object},data:function(){return{frame:!1,loading:!0,fullScreen:!1,breadCrumbs:[],startPage:this.uipData.dynamicOptions.viewadmin.value,cornertickle:!1,currentURL:!1}},inject:["uipData","uipress","uiTemplate","router"],watch:{"uipData.themeStyles":{handler(e,t){this.injectStyles()},deep:!0},"uiTemplate.globalSettings.options.advanced.css":{handler(e,t){this.injectStyles()},deep:!0}},mounted:function(){let e=this;if(this.frame=this.$refs.contentframe,"prod"==e.uiTemplate.display){if(e.startPage=window.location.href,e.returnHomePage){let t=this.uipData.dynamicOptions.viewadmin.value;if(e.startPage==t||e.startPage==t+"#/"){new RegExp("^(?:[a-z+]+:)?//","i").test(e.returnHomePage)?e.startPage=e.returnHomePage:e.startPage=t+e.returnHomePage}}let t=new URL(e.startPage);t=e.formatUserUrlOptions(t),e.frame.contentWindow.location.replace(t),e.uipress.updateActiveLink(e.startPage.replace("#/","")),window.onpopstate=function(){window.location.href!=e.startPage&&(e.startPage=window.location.href)},window.onhashchange=function(){window.location.href!=e.startPage&&(e.startPage=window.location.href)}}document.addEventListener("uip_breadcrumbs_change",t=>{e.breadCrumbs=t.detail.crumbs},{once:!1}),document.addEventListener("uip_update_frame_url",t=>{let i=t.detail.url;e.loading=!0,setTimeout(function(){e.loading=!1},2e3),i=e.formatUserUrlOptions(i),e.frame.contentWindow.location.replace(i)},{once:!1}),this.frame.onload=function(){try{e.frame.contentWindow.title}catch(t){return void(e.currentURL&&window.location.assign(e.currentURL))}e.frame.contentWindow,e.loading=!1,e.injectStyles();let t=e.frame.contentDocument.title;t&&""!=t&&(document.title=t),this.uipPageChangeLoaded=new CustomEvent("uip_page_change_loaded"),document.dispatchEvent(this.uipPageChangeLoaded),e.updatePageUrls()},this.iframeURLChange(e.frame,function(t){e.loading=!0,e.currentURL=t,setTimeout(function(){e.loading=!1},2e3);let i=new URL(t);if(e.uipress.forceReload(i),i.searchParams.get("uip-framed-page")){let i=e.frame.contentWindow.document.querySelectorAll("#adminmenu a[aria-current='page']"),n=t;return i[0]&&(n=i[0].getAttribute("href")),n.includes("about:blank")?(e.injectStyles(),void(e.loading=!1)):(e.uipress.updateActiveLink(n),e.injectStyles(),void(e.loading=!1))}i=e.formatUserUrlOptions(i),e.frame.contentWindow.location.replace(i)})},computed:{returnHomePage(){let e=this.uipress.get_block_option(this.block,"block","loginRedirect",!0);return this.uipress.isObject(e)?"value"in e&&e.value:e},returnTheme(){return this.block.settings.block.options.disableTheme.value},returnNotices(){return this.uipress.get_block_option(this.block,"block","hidePluginNotices")},returnScreen(){return this.block.settings.block.options.hideScreenOptions.value},returnHelp(){return this.block.settings.block.options.hideHelpTab.value},returnToolbar(){return!!this.block.settings.block.options.disableToolbar&&this.block.settings.block.options.disableToolbar.value},returnClasses(){let e="";return e+=this.uipress.get_block_option(this.block,"advanced","classes"),this.fullScreen&&(e+="uip-fullscreen-mode uip-scale-in-bottom-right"),e},returnTemplateCSS(){if(void 0!==this.uiTemplate.globalSettings.options)return"advanced"in this.uiTemplate.globalSettings.options&&"css"in this.uiTemplate.globalSettings.options.advanced?this.uiTemplate.globalSettings.options.advanced.css:void 0}},methods:{updatePageUrls(){let e=this,t=[],i=this.uipData.options.adminURL;t=e.frame.contentWindow.document.querySelectorAll("form");for(let n of t){let t=n.action;void 0!==t&&""!=t&&"string"==typeof t&&(t.includes(i)&&(n.action=e.formatRequiredParams(t)))}let n=e.frame.contentWindow.document.querySelectorAll("body.update-php a");for(let t of n){let n=t.href;if(void 0!==n&&""!=n&&"string"==typeof n)if(n.includes(i))t.href=e.formatRequiredParams(n);else{let a=i+n,r=e.formatRequiredParams(a);r=r.replace(i,""),t.href=r}}},formatUserUrlOptions(e){return e.searchParams.set("uip-framed-page",1),this.returnScreen&&e.searchParams.set("uip-hide-screen-options",1),this.returnHelp&&e.searchParams.set("uip-hide-help-tab",1),this.returnTheme&&e.searchParams.set("uip-default-theme",1),this.returnNotices&&e.searchParams.set("uip-hide-notices",1),e.searchParams.set("uipid",this.uiTemplate.id),e},formatRequiredParams(e){let t=new URL(e);return t.searchParams.set("uip-framed-page",1),this.returnScreen&&t.searchParams.set("uip-hide-screen-options",1),this.returnHelp&&t.searchParams.set("uip-hide-help-tab",1),this.returnTheme&&t.searchParams.set("uip-default-theme",1),this.returnNotices&&t.searchParams.set("uip-hide-notices",1),t.searchParams.set("uipid",this.uiTemplate.id),t.href},isFullScreen(){return!!document.getElementById(this.block.uid).classList.contains("uip-fullscreen-mode")},disableFullScreen(){return this.uipress.get_block_option(this.block,"block","disableFullScreen")},toggleFullScreen(){let e=document.getElementById(this.block.uid);this.isFullScreen()?(e.classList.remove("uip-fullscreen-mode"),e.classList.remove("uip-scale-in-bottom-right")):(e.classList.add("uip-fullscreen-mode"),e.classList.add("uip-scale-in-bottom-right"))},injectStyles(){if("prod"==this.uiTemplate.display)return;let e=this.uipData.themeStyles;this.frame=this.$refs.contentframe;let t=this.frame.contentWindow.document.getElementById("uip-theme-styles");if(!t)return;let i='html[data-theme="light"]{';for(let t in e){let n=e[t];n.value&&(i+=n.name+":"+n.value+";")}i+="}";let n='html[data-theme="dark"]{';for(let t in e){let i=e[t];i.darkValue&&(n+=i.name+":"+i.darkValue+";")}n+="}";let a=this.returnTemplateCSS;t.innerHTML=i+n+a},injectCSS(){this.frame=this.$refs.contentframe;let e=this.frame.contentWindow.document.getElementById("uip-theme-styles");if(!e)return;let t=this.returnTemplateCSS;e.innerText=t},iframeURLChange(e,t){let i=null,n=function(){var n=e.contentWindow.location.href;n!==i&&(t(n),i=n)},a=function(){setTimeout(n,0)};function r(){e.contentWindow.removeEventListener("unload",a),e.contentWindow.addEventListener("unload",a)}e.addEventListener("load",function(){r(),n()}),r()}},template:'\x3c!--builder mode--\x3e\n      <div ref="frameContainer" class="uip-flex uip-flex-column uip-overflow-hidden uip-content-frame uip-overflow-hidden uip-position-relative" :class="returnClasses" :id="block.uid">\n        <div class="uip-position-relative">\n          <div ref="loader" :class="block.uid" class="uip-ajax-loader" v-if="loading">\n            <div :class="block.uid" class="uip-loader-bar"></div>\n          </div>\n        </div>\n        <iframe v-if="uiTemplate.display == \'prod\'" ref="contentframe" class="uip-page-content-frame uip-background-default uip-scrollbar uip-w-100p uip-flex-grow" \n        ></iframe>\n        <iframe v-else :src="startPage" ref="contentframe" class="uip-page-content-frame uip-background-default uip-scrollbar uip-w-100p uip-flex-grow" \n        ></iframe>\n        <div @mouseover="cornertickle = true" @mouseleave="cornertickle = false" class="uip-position-absolute uip-text-muted uip-top-0 uip-right-0 uip-cursor-pointer uip-translate-all-back-50p uip-w-60 uip-ratio-1-1 uip-flex uip-flex-column uip-flex-middle uip-padding-xs " v-if="!disableFullScreen()">\n          <div @click="toggleFullScreen()" v-if="cornertickle" class="uip-border-box uip-background-muted uip-text-muted uip-padding-xxxs uip-cursor-pointer hover:uip-background-grey uip-w-60 uip-ratio-1-1 uip-flex uip-flex-column uip-flex-middle uip-fade-in">\n            <span v-if="isFullScreen()" class="uip-icon uip-text-xl uip-slide-in-right">arrow_back</span>\n            <span v-if="!isFullScreen()" class="uip-icon uip-text-xl uip-slide-in-right">arrow_forward</span>\n          </div>\n        </div>\n      </div>'}};