const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{inject:["uipData","router","uipress"],data:function(){return{loading:!0,templateID:this.$route.params.templateID,layoutFetched:!1,unsavedChanges:!1,welcomeMessage:!0,ui:{modal:{open:!1,activeModule:"",title:"",args:{}},settingsPanel:{pos:{}},layers:{display:this.uipData.userPrefs.builderLayers},sideBar:{activeTab:"blocks"},strings:{layers:__("Layers","uipress-lite"),welcomeTitle:__("Welcome to the uiBuilder","uipress-lite"),welcomeMeta:__("Brand new for UiPress 3, the uiBuilder is a powerful drag and drop tool for building great looking, functional admin experiences for yourself or your clients","uipress-lite"),browseTemplates:__("Browse premade templates or start from scratch","uipress-lite"),blankCanvas:__("Blank canvas","uipress-lite"),viewTemplates:__("View templates","uipress-lite"),dontShowAgain:__("Don't show this again","uipress-lite"),close:__("Close","uipress-lite"),deletesAllBlocks:__("Deletes all blocks","uipress-lite"),hideLayers:__("Hide layers","uipress-lite")}},template:{activePath:[],activePathLock:!1,windowWidth:window.innerWidth,patterns:[],googleAnalyticsRequest:{range:{start:"",end:""},fetching:!1,data:{}},display:"builder",globalSettings:{name:__("Draft Layout","uipress-lite"),status:!1,rolesAndUsers:[],excludesRolesAndUsers:[],type:"ui-template",options:{},menuIcon:{value:""},code:{css:"",js:""}},content:[]},switchOptions:{blocks:{value:"blocks",label:__("Blocks","uipress-lite")},patterns:{value:"patterns",label:__("Patterns","uipress-lite")},library:{value:"library",label:__("Library","uipress-lite")},settings:{value:"settings",label:__("Settings","uipress-lite")}}}},watch:{"ui.sideBar.activeTab":{handler(e,i){this.$router.push({query:{tab:e}})},deep:!0},"$route.params.templateID":{handler(){this.templateID=this.$route.params.templateID,this.getTemplate()}}},provide(){return{uiTemplate:this.returnTemplateData,layersPanel:this.ui.layers,openModal:this.openModal,unsavedChanges:this.returnUnsaved}},mounted:function(){this.loading=!1,this.getTemplate();let e=this;for(const i in e.template.layout){let t=e.template.layout[i];e.buildOptions(t.optionsEnabled,t.settings)}let i=this.$route.query;i&&i.tab&&(this.ui.sideBar.activeTab=i.tab)},computed:{returnTemplateData(){return this.template},returnLayers(){return this.ui.layers},currentRouteName(){return this.$route.name},returnUnsaved(){return this.unsavedChanges},returnOptionsWidth(){let e=parseFloat(this.uipData.userPrefs.builderOptionsWodth);return!((!e||void 0===e||""==e)&&isNaN(e))&&"width:"+e+"px;"}},methods:{injectSavedStyles(e){let i=this.uipData.themeStyles;for(let t in i){let s=i[t];e[s.name]&&("value"in e[s.name]&&(s.value=e[s.name].value),"darkValue"in e[s.name]&&(s.darkValue=e[s.name].darkValue))}for(let i in e){let t=e[i];t.user&&(this.uipData.themeStyles[t.name]=t)}},getTemplate(){let e=this,i=new FormData;i.append("action","uip_get_ui_template"),i.append("security",uip_ajax.security),i.append("templateID",e.templateID),e.uipress.callServer(uip_ajax.ajax_url,i).then(i=>{if(i.error)return void e.uipress.notify(i.message,"","error",!0);i.styles&&e.injectSavedStyles(i.styles);let t=i.settings[0],s=i.content;e.template.patterns=i.patterns,s?(e.template.content=s,t?("excludesRolesAndUsers"in t&&(e.template.globalSettings.excludesRolesAndUsers=t.excludesRolesAndUsers),"rolesAndUsers"in t&&(e.template.globalSettings.rolesAndUsers=t.rolesAndUsers),"name"in t&&(e.template.globalSettings.name=t.name),"status"in t&&(e.template.globalSettings.status=t.status),"type"in t&&(e.template.globalSettings.type=t.type),"excludesRolesAndUsers"in t&&(e.template.globalSettings.excludesRolesAndUsers=t.excludesRolesAndUsers),"applyToSubsites"in t&&(e.template.globalSettings.applyToSubsites=t.applyToSubsites),"options"in t&&(e.template.globalSettings.options=t.options),"menuParent"in t&&(e.template.globalSettings.menuParent=t.menuParent),"menuIcon"in t&&(e.template.globalSettings.menuIcon=t.menuIcon),e.formatBuilderGroupOptions(),e.layoutFetched=!0,e.unsavedChanges=!1):e.layoutFetched=!0):e.layoutFetched=!0})},formatBuilderGroupOptions(){let e=this.uipData.templateGroupOptions,i=this.template.globalSettings.options;for(let[t,s]of Object.entries(e)){t in i||(i[t]={});for(let e of s.settings)!s.uniqueKey in i[t]&&(e.accepts===String&&(i[group][t]=""),e.accepts===Array&&(i[group][t]=[]),e.accepts===Object&&(i[group][t]={}))}},openThemeLibrary(){this.$router.push({query:{tab:"library"}}),this.ui.sideBar.activeTab="library"},suppressWelcome(){this.welcomeMessage=!1,this.uipData.userPrefs.supressBuilderWelcome=!0,this.uipress.saveUserPreference("supressBuilderWelcome",!0,!1)},closeLayersPanel(){this.ui.layers.display=!1,this.uipress.saveUserPreference("builderLayers",!1,!1)},openModal(e,i,t){e&&""!=e&&(this.ui.modal.activeModule=e,this.ui.modal.title=i,this.ui.modal.args=t,this.ui.modal.open=!0,requestAnimationFrame(()=>{document.documentElement.addEventListener("click",this.onClickOutside,!1)}))},onClickOutside(e){if(!this.$refs.uipmodal)return;const i=e.path||(e.composedPath?e.composedPath():void 0);!i||i.includes(this.$refs.uipmodal)||this.$refs.uipmodal.contains(e.target)||this.closeThisComponent()},closeThisComponent(){this.ui.modal.open=!1,document.documentElement.removeEventListener("click",this.onClickOutside,!1)},confirmEmptyTemplate(){let e=JSON.parse(JSON.stringify(this.template.content)),i=this;this.uipress.confirm(__("Are you sure?","uipress-lite"),__("This will delete all blocks from your template.","uipress-lite")).then(t=>{t&&(i.template.content=[],i.uipress.logHistoryChange(__("Template blocks deleted","uipress-lite"),e,[]))})},componentExists(e){return!!this.$root._.appContext.components[e]},mouseMoveHandler(e){const i=document.getElementById("uip-builder-settings-panel");let t=e.clientX-this.ui.settingsPanel.pos.startX;i.style.width=this.ui.settingsPanel.pos.width-t+"px"},mouseUpHandler(){document.removeEventListener("mousemove",this.mouseMoveHandler,!0),document.removeEventListener("mouseup",this.mouseUpHandler,!0);const e=document.getElementById("uip-builder-settings-panel");this.uipress.saveUserPreference("builderOptionsWodth",e.style.width,!1)},mouseDownHandler(e){const i=document.getElementById("uip-builder-settings-panel");this.ui.settingsPanel.pos={startX:e.clientX,width:parseInt(i.getBoundingClientRect().width,10)},document.addEventListener("mousemove",this.mouseMoveHandler,!0),document.addEventListener("mouseup",this.mouseUpHandler,!0)}},template:'\n      <div v-if="!layoutFetched" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-flex-center uip-flex-middle" style="min-height: calc(100vh - 32px); max-height: calc(100vh - 32px)">\n        <loading-chart></loading-chart>\n      </div>\n    \n      <div v-if="layoutFetched" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-text-normal uip-app-frame uip-border-box uip-builder-frame">\n      \n        <div class="uip-flex uip-h-100p uip-w-100p">\n        \n          \x3c!-- Preview --\x3e\n          <div class="uip-flex-grow uip-background-muted">\n            <ui-preview></ui-preview>\n          </div>\n          \x3c!--End preview--\x3e\n          \n          \x3c!--Layers panel --\x3e\n          <div class="uip-overflow-auto uip-padding-xs uip-scrollbar uip-border-left uip-slide-in-right uip-app-frame uip-flex-no-shrink" v-if="ui.layers.display">\n          \n            <div class="uip-flex uip-gap-xs uip-flex-center uip-margin-bottom-s uip-flex-between uip-padding-xs">\n              <div class="uip-text-bold uip-text-l">{{ui.strings.layers}}</div>\n              \n              <div class="uip-flex uip-gap-xxs">\n              \n                <uip-tooltip :message="ui.strings.deletesAllBlocks" :delay="200">\n                  <span @click="confirmEmptyTemplate()" class="uip-padding-xxxs uip-border-round hover:uip-background-grey uip-cursor-pointer uip-flex uip-flex-middle uip-flex-center uip-ratio-1-1 uip-flex-middle">\n                    <span class="uip-icon uip-text-l uip-line-height-1">clear_all</span>\n                  </span>\n                </uip-tooltip>\n                \n                <uip-tooltip :message="ui.strings.hideLayers" :delay="200">\n                  <span @click="ui.layers.display = false" class="uip-padding-xxxs uip-border-round hover:uip-background-grey uip-cursor-pointer uip-flex uip-flex-middle uip-flex-center uip-ratio-1-1 uip-flex-middle">\n                    <span class="uip-icon uip-text-l uip-line-height-1">arrow_right_alt</span>\n                  </span>\n                </uip-tooltip>\n                \n              </div>\n              \n            </div>\n            \n            <div class="uip-w-250">\n              <uip-treeview-drop-area :content="template.content" :returnData="function(data){template.content = data}" ></uip-treeview-drop-area>\n            </div>\n            \n          </div>\n          \x3c!--End Layers panel --\x3e\n          \n          \n          \x3c!--Right bar --\x3e\n          <div class="uip-panel-options uip-w-350 uip-border-left uip-app-frame uip-flex-no-shrink uip-position-relative" id="uip-builder-settings-panel" :style="returnOptionsWidth">\n            <div class="uip-flex uip-flex-column uip-h-100p uip-max-h-100p">\n              <template v-if="currentRouteName == \'Builder\'">\n              <div class="uip-padding-s uip-border-box">\n                <toggle-switch :options="switchOptions" :activeValue="ui.sideBar.activeTab" :returnValue="function(data){ ui.sideBar.activeTab = data}"></toggle-switch>\n              </div>\n              \x3c!-- OUTPUT SETTINGS OR BLOCKS --\x3e\n              <div class="uip-flex-grow uip-overflow-auto uip-padding-s uip-scrollbar uip-padding-top-remove">\n                <builder-settings v-if="ui.sideBar.activeTab == \'settings\'"></builder-settings>\n                <patterns-list v-if="ui.sideBar.activeTab == \'patterns\'"></patterns-list>\n                <builder-blocks-list v-if="ui.sideBar.activeTab == \'blocks\'"></builder-blocks-list>\n                <uip-template-library v-if="ui.sideBar.activeTab == \'library\'"></uip-template-library>\n              </div>\n              </template>\n              <router-view :key="$route.path"></router-view>\n            </div>\n            <div @mousedown="mouseDownHandler" ref="uipPanelResize"\n            class="uip-background-muted uip-border uip-border-round uip-position-absolute uip-left-0 uip-top-50p uip-w-10 uip-h-24 uip-translate-all-50p uip-cursor-drag uip-no-text-select uip-flex uip-flex-center uip-flex-middle">\n              <span class="uip-icon">drag_indicator</span>\n            </div>\n          </div>\n          \x3c!-- End right bar --\x3e\n          \n        </div>\n        \n\t    </div>\n    \n      <div ref="modalOuter" v-if="ui.modal.activeModule != \'\' && ui.modal.open" class="uip-position-fixed uip-top-0 uip-left-0 uip-h-viewport uip-w-vw uip-background-black-wash uip-flex uip-flex-center uip-flex-middle uip-fade-in">\n        <div ref="uipmodal" class="uip-background-default uip-border-round uip-border uip-flex uip-flex-column uip-row-gap-s uip-scale-in uip-min-w-350 uip-w-600 uip-max-w-100p uip-text-normal">\n          <div class="uip-flex uip-flex-between  uip-padding-s">\n            <div class="uip-text-bold uip-text-l">{{ui.modal.title}}</div>\n            <div @click="closeThisComponent()" class="hover:uip-background-grey uip-padding-xxs uip-border-round uip-cursor-pointer">\n              <div class="uip-icon uip-text-l">close</div>\n            </div>\n          </div>\n          <div class="uip-max-h-500 uip-overflow-auto uip-scrollbar  uip-padding-s uip-padding-top-remove">\n            <component :is="ui.modal.activeModule" :args="ui.modal.args"></component>\n          </div>\n        </div>\n      </div>\n  \n      \x3c!--Import plugins --\x3e\n      <template v-for="plugin in uipData.plugins" v-if="layoutFetched">\n        <component v-if="componentExists(plugin.component) && plugin.loadInApp" :is="plugin.component"></component>\n      </template>\n      \x3c!-- end plugin import --\x3e\n    \n      <div v-if="welcomeMessage && !uipData.userPrefs.supressBuilderWelcome" class="uip-position-fixed uip-top-0 uip-left-0 uip-h-viewport uip-w-vw uip-background-black-wash uip-flex uip-flex-center uip-flex-middle uip-fade-in">\n        <div class="uip-background-default uip-border-round uip-overflow-hidden uip-flex uip-flex-column uip-row-gap-xs uip-scale-in uip-min-w-350 uip-w-450">\n          <div class="uip-flex uip-flex-row uip-padding-s uip-gap-s  uip-flex-center uip-background-primary uip-padding-top-m uip-padding-bottom-m">\n            <div class="uip-logo-inverse uip-w-28 uip-h-28"></div>\n            <div class="uip-text-xl uip-text-emphasis uip-text-bold uip-text-inverse">{{ui.strings.welcomeTitle}}!</div>\n          </div>\n          <div class="uip-flex uip-flex-column uip-row-gap-s uip-padding-s">\n            <div class="uip-text-normal uip-text-m">{{ui.strings.welcomeMeta}}</div>\n            <div class="uip-text-normal uip-text-m">{{ui.strings.browseTemplates}}</div>\n            <div class="uip-flex uip-flex-row uip-gap-s uip-margin-top-xs">\n              <button class="uip-button-default" @click="suppressWelcome()">{{ui.strings.dontShowAgain}}</button>\n              <div class="uip-flex uip-gap-xs uip-flex-grow uip-flex-right">\n                <button class="uip-button-secondary" @click="welcomeMessage = false">{{ui.strings.blankCanvas}}</button>\n                <button class="uip-button-secondary" @click="welcomeMessage = false; openThemeLibrary()">{{ui.strings.viewTemplates}}</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>'}};